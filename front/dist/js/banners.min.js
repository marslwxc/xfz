function Banner(){}Banner.prototype.loadData=function(){var i=this;xfzajax.get({url:"/cms/banner_list",success:function(n){if(200===n.code)for(var e=n.data,a=0;a<e.length;a++){var t=e[a];i.createBannerItem(t)}}})},Banner.prototype.listenAddBannerEvent=function(){var n=this;$("#add-banner-btn").click(function(){6<=$(".banner-list-group").children().length?window.messageBox.showInfo("最多只能添加6张轮播图！"):n.createBannerItem()})},Banner.prototype.createBannerItem=function(n){var e=this,a=template("banner-item",{banner:n}),t=$(".banner-list-group");if(n){t.append(a);var i=t.find(".banner-item:last")}else{t.prepend(a);i=t.find(".banner-item:first")}e.addImageSelectEvent(i),e.addRemoveBannerEvent(i),e.addSaveBannerEvent(i)},Banner.prototype.addImageSelectEvent=function(n){var e=n.find(".thumbnail");e.attr("id","doing");var a=n.find(".image-input");e.click(function(){a.click()}),a.change(function(){var r=this.files[0];xfzajax.get({url:"/cms/qntoken/",success:function(n){if(200===n.code){var e=n.data.token,a=(new Date).getTime()+"."+r.name.split(".")[1],t={fname:a,params:{},mimeType:["image/png","image/jpeg","image/gif","video/x-ms-wmv"]},i={useCdnDomain:!0,region:qiniu.region.z2,retryCount:6};qiniu.upload(r,a,e,t,i).subscribe({next:function(n){},error:function(n){window.messageBox.showerrors("图片长传出错")},complete:function(n){window.messageBox.showInfo("图片上传完成");var e="http://q5ttl3pxu.bkt.clouddn.com/"+n.key,a=$("#doing");a.attr("src",e),a.attr("id","")}})}}})})},Banner.prototype.addRemoveBannerEvent=function(e){e.find(".close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({text:"您确定要删除这个轮播图吗?",confirmCallback:function(){xfzajax.post({url:"/cms/delete_banner/",data:{banner_id:n},success:function(n){200===n.code&&(e.remove(),window.messageBox.showSuccess("轮播图删除才成功！"))}})}}):e.remove()})},Banner.prototype.addSaveBannerEvent=function(t){var n=t.find(".save-btn"),i=t.find(".thumbnail"),r=t.find("input[name='priority']"),o=t.find("input[name='link_to']"),c=t.find('span[class="priority"]'),s=t.attr("data-banner-id"),d="";d=s?"/cms/edit_banner/":"/cms/add_banner/",console.log(s),n.click(function(){var n=i.attr("src"),e=r.val(),a=o.val();xfzajax.post({url:d,data:{image_url:n,priority:e,link_to:a,pk:s},success:function(n){200===n.code&&(s?window.messageBox.showSuccess("轮播图修改成功！"):(s=n.data.banner_id,t.attr("data-banner-id",s),window.messageBox.showSuccess("轮播图添加完成！")),c.text("优先级："+e))}})})},Banner.prototype.run=function(){this.listenAddBannerEvent(),this.loadData()},$(function(){(new Banner).run()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJhbm5lcnMuanMiXSwibmFtZXMiOlsiQmFubmVyIiwicHJvdG90eXBlIiwibG9hZERhdGEiLCJzZWxmIiwidGhpcyIsInhmemFqYXgiLCJnZXQiLCJ1cmwiLCJzdWNjZXNzIiwicmVzdWx0IiwiYmFubmVycyIsImkiLCJsZW5ndGgiLCJiYW5uZXIiLCJjcmVhdGVCYW5uZXJJdGVtIiwibGlzdGVuQWRkQmFubmVyRXZlbnQiLCIkIiwiY2xpY2siLCJjaGlsZHJlbiIsIndpbmRvdyIsIm1lc3NhZ2VCb3giLCJzaG93SW5mbyIsInRwbCIsInRlbXBsYXRlIiwiYmFubmVyTGlzdEdyb3VwIiwiYXBwZW5kIiwiYmFubmVySXRlbSIsImZpbmQiLCJwcmVwZW5kIiwiYWRkSW1hZ2VTZWxlY3RFdmVudCIsImFkZFJlbW92ZUJhbm5lckV2ZW50IiwiYWRkU2F2ZUJhbm5lckV2ZW50IiwiaW1hZ2UiLCJhdHRyIiwiaW1hZ2VJbnB1dCIsImNoYW5nZSIsImZpbGUiLCJmaWxlcyIsInRva2VuIiwia2V5IiwiRGF0ZSIsImdldFRpbWUiLCJuYW1lIiwic3BsaXQiLCJwdXRFeHRyYSIsImZuYW1lIiwicGFyYW1zIiwibWltZVR5cGUiLCJjb25maWciLCJ1c2VDZG5Eb21haW4iLCJyZWdpb24iLCJxaW5pdSIsInoyIiwicmV0cnlDb3VudCIsInVwbG9hZCIsInN1YnNjcmliZSIsIm5leHQiLCJyZXNwb25zZSIsImVycm9yIiwic2hvd2Vycm9ycyIsImNvbXBsZXRlIiwiYmFubmVySWQiLCJ4ZnphbGVydCIsImFsZXJ0Q29uZmlybSIsInRleHQiLCJjb25maXJtQ2FsbGJhY2siLCJwb3N0IiwiZGF0YSIsImJhbm5lcl9pZCIsInJlbW92ZSIsInNob3dTdWNjZXNzIiwic2F2ZUJ0biIsImltYWdlVGFnIiwicHJpb3JpdHlUYWciLCJsaW5rdG9UYWciLCJwcmlvcml0eVNwYW4iLCJjb25zb2xlIiwibG9nIiwiaW1hZ2VfdXJsIiwicHJpb3JpdHkiLCJ2YWwiLCJsaW5rX3RvIiwi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OUMsRUFBV0MsS0FBSyxjQUMzQjhDLEVBQWMvQyxFQUFXQyxLQUFLLDBCQUM5QitDLEVBQVloRCxFQUFXQyxLQUFLLHlCQUM1QmdELEVBQWVqRCxFQUFXQyxLQUFLLDBCQUMvQmtDLEVBQVduQyxFQUFXTyxLQUFLLGtCQUMzQjFCLEVBQU0sR0FFTkEsRUFEQXNELEVBQ00sb0JBRUEsbUJBRVZlLFFBQVFDLElBQUloQixHQUNaVSxFQUFRdEQsTUFBTSxXQUNWLElBQUk2RCxFQUFZTixFQUFTdkMsS0FBSyxPQUMxQjhDLEVBQVdOLEVBQVlPLE1BQ3ZCQyxFQUFVUCxFQUFVTSxNQUN4QjNFLFFBQVE2RCxLQUFLLENBQ1QzRCxJQUFPQSxFQUNQNEQsS0FBUSxDQUNKVyxVQUFhQSxFQUNiQyxTQUFZQSxFQUNaRSxRQUFXQSxFQUNYQyxHQUFNckIsR0FFVnJELFFBQVcsU0FBU0MsR0FDTyxNQUFuQkEsRUFBYSxPQUNUb0QsRUFDQTFDLE9BQU9DLFdBQVdrRCxZQUFZLGFBRTlCVCxFQUFXcEQsRUFBYSxLQUFhLFVBQ3JDaUIsRUFBV08sS0FBSyxpQkFBa0I0QixHQUNsQzFDLE9BQU9DLFdBQVdrRCxZQUFZLGFBRWxDSyxFQUFhWCxLQUFLLE9BQVNlLFVBTy9DL0UsT0FBT0MsVUFBVWtGLElBQU0sV0FDbkIvRSxLQUFLVyx1QkFDTFgsS0FBS0YsWUFHVGMsRUFBRSxZQUNlLElBQUloQixRQUNWbUYiLCJmaWxlIjoiYmFubmVycy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBCYW5uZXIoKSB7fVxyXG5cclxuQmFubmVyLnByb3RvdHlwZS5sb2FkRGF0YSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgeGZ6YWpheC5nZXQoe1xyXG4gICAgICAgICd1cmwnOiAnL2Ntcy9iYW5uZXJfbGlzdCcsXHJcbiAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBiYW5uZXJzID0gcmVzdWx0WydkYXRhJ107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJhbm5lcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmFubmVyID0gYmFubmVyc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmNyZWF0ZUJhbm5lckl0ZW0oYmFubmVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5CYW5uZXIucHJvdG90eXBlLmxpc3RlbkFkZEJhbm5lckV2ZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB2YXIgYWRkQnRuID0gJChcIiNhZGQtYmFubmVyLWJ0blwiKTtcclxuICAgIGFkZEJ0bi5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYmFubmVyTGlzdEdyb3VwID0gJChcIi5iYW5uZXItbGlzdC1ncm91cFwiKTtcclxuICAgICAgICB2YXIgbGVuZ3RoID0gYmFubmVyTGlzdEdyb3VwLmNoaWxkcmVuKCkubGVuZ3RoO1xyXG4gICAgICAgIGlmIChsZW5ndGggPj0gNikge1xyXG4gICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93SW5mbyhcIuacgOWkmuWPquiDvea3u+WKoDblvKDova7mkq3lm77vvIFcIik7XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxmLmNyZWF0ZUJhbm5lckl0ZW0oKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5CYW5uZXIucHJvdG90eXBlLmNyZWF0ZUJhbm5lckl0ZW0gPSBmdW5jdGlvbihiYW5uZXIpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciB0cGwgPSB0ZW1wbGF0ZShcImJhbm5lci1pdGVtXCIsIHsgJ2Jhbm5lcic6IGJhbm5lciB9KTtcclxuICAgIHZhciBiYW5uZXJMaXN0R3JvdXAgPSAkKFwiLmJhbm5lci1saXN0LWdyb3VwXCIpO1xyXG4gICAgaWYgKGJhbm5lcikge1xyXG4gICAgICAgIGJhbm5lckxpc3RHcm91cC5hcHBlbmQodHBsKTtcclxuICAgICAgICB2YXIgYmFubmVySXRlbSA9IGJhbm5lckxpc3RHcm91cC5maW5kKFwiLmJhbm5lci1pdGVtOmxhc3RcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGJhbm5lckxpc3RHcm91cC5wcmVwZW5kKHRwbCk7XHJcbiAgICAgICAgdmFyIGJhbm5lckl0ZW0gPSBiYW5uZXJMaXN0R3JvdXAuZmluZChcIi5iYW5uZXItaXRlbTpmaXJzdFwiKTtcclxuICAgIH1cclxuICAgIHNlbGYuYWRkSW1hZ2VTZWxlY3RFdmVudChiYW5uZXJJdGVtKTtcclxuICAgIHNlbGYuYWRkUmVtb3ZlQmFubmVyRXZlbnQoYmFubmVySXRlbSk7XHJcbiAgICBzZWxmLmFkZFNhdmVCYW5uZXJFdmVudChiYW5uZXJJdGVtKTtcclxufVxyXG5cclxuQmFubmVyLnByb3RvdHlwZS5hZGRJbWFnZVNlbGVjdEV2ZW50ID0gZnVuY3Rpb24oYmFubmVySXRlbSkge1xyXG4gICAgdmFyIGltYWdlID0gYmFubmVySXRlbS5maW5kKCcudGh1bWJuYWlsJyk7XHJcbiAgICBpbWFnZS5hdHRyKCdpZCcsICdkb2luZycpO1xyXG4gICAgdmFyIGltYWdlSW5wdXQgPSBiYW5uZXJJdGVtLmZpbmQoJy5pbWFnZS1pbnB1dCcpO1xyXG4gICAgaW1hZ2UuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaW1hZ2VJbnB1dC5jbGljaygpO1xyXG4gICAgfSk7XHJcbiAgICBpbWFnZUlucHV0LmNoYW5nZShmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgZmlsZSA9IHRoaXMuZmlsZXNbMF07XHJcbiAgICAgICAgeGZ6YWpheC5nZXQoe1xyXG4gICAgICAgICAgICAndXJsJzogJy9jbXMvcW50b2tlbi8nLFxyXG4gICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSByZXN1bHRbJ2RhdGEnXVsndG9rZW4nXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKSArICcuJyArIGZpbGUubmFtZS5zcGxpdCgnLicpWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwdXRFeHRyYSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm5hbWU6IGtleSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7fSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWltZVR5cGU6IFsnaW1hZ2UvcG5nJywgJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvZ2lmJywgJ3ZpZGVvL3gtbXMtd212J11cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZUNkbkRvbWFpbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiBxaW5pdS5yZWdpb24uejIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5Q291bnQ6IDZcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYnNlcnZlciA9IHFpbml1LnVwbG9hZChmaWxlLCBrZXksIHRva2VuLCBwdXRFeHRyYSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5zdWJzY3JpYmUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dCc6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7fSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJzogZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dlcnJvcnMoXCLlm77niYfplb/kvKDlh7rplJlcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbXBsZXRlJzogZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dJbmZvKFwi5Zu+54mH5LiK5Lyg5a6M5oiQXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvbWFpbiA9ICdodHRwOi8vcTV0dGwzcHh1LmJrdC5jbG91ZGRuLmNvbS8nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gcmVzcG9uc2Uua2V5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IGRvbWFpbiArIGZpbGVuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0gJChcIiNkb2luZ1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLmF0dHIoJ3NyYycsIHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZS5hdHRyKCdpZCcsICcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5CYW5uZXIucHJvdG90eXBlLmFkZFJlbW92ZUJhbm5lckV2ZW50ID0gZnVuY3Rpb24oYmFubmVySXRlbSkge1xyXG4gICAgdmFyIGNsb3NlQnRuID0gYmFubmVySXRlbS5maW5kKCcuY2xvc2UtYnRuJyk7XHJcbiAgICBjbG9zZUJ0bi5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgYmFubmVySWQgPSBiYW5uZXJJdGVtLmF0dHIoJ2RhdGEtYmFubmVyLWlkJyk7XHJcbiAgICAgICAgaWYgKGJhbm5lcklkKSB7XHJcbiAgICAgICAgICAgIHhmemFsZXJ0LmFsZXJ0Q29uZmlybSh7XHJcbiAgICAgICAgICAgICAgICAndGV4dCc6ICfmgqjnoa7lrpropoHliKDpmaTov5nkuKrova7mkq3lm77lkJc/JyxcclxuICAgICAgICAgICAgICAgICdjb25maXJtQ2FsbGJhY2snOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB4ZnphamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogJy9jbXMvZGVsZXRlX2Jhbm5lci8nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGF0YSc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiYW5uZXJfaWQnOiBiYW5uZXJJZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dTdWNjZXNzKCfova7mkq3lm77liKDpmaTmiY3miJDlip/vvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBiYW5uZXJJdGVtLnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5CYW5uZXIucHJvdG90eXBlLmFkZFNhdmVCYW5uZXJFdmVudCA9IGZ1bmN0aW9uKGJhbm5lckl0ZW0pIHtcclxuICAgIHZhciBzYXZlQnRuID0gYmFubmVySXRlbS5maW5kKCcuc2F2ZS1idG4nKTtcclxuICAgIHZhciBpbWFnZVRhZyA9IGJhbm5lckl0ZW0uZmluZChcIi50aHVtYm5haWxcIik7XHJcbiAgICB2YXIgcHJpb3JpdHlUYWcgPSBiYW5uZXJJdGVtLmZpbmQoXCJpbnB1dFtuYW1lPSdwcmlvcml0eSddXCIpO1xyXG4gICAgdmFyIGxpbmt0b1RhZyA9IGJhbm5lckl0ZW0uZmluZChcImlucHV0W25hbWU9J2xpbmtfdG8nXVwiKTtcclxuICAgIHZhciBwcmlvcml0eVNwYW4gPSBiYW5uZXJJdGVtLmZpbmQoJ3NwYW5bY2xhc3M9XCJwcmlvcml0eVwiXScpO1xyXG4gICAgdmFyIGJhbm5lcklkID0gYmFubmVySXRlbS5hdHRyKFwiZGF0YS1iYW5uZXItaWRcIik7XHJcbiAgICB2YXIgdXJsID0gJyc7XHJcbiAgICBpZiAoYmFubmVySWQpIHtcclxuICAgICAgICB1cmwgPSAnL2Ntcy9lZGl0X2Jhbm5lci8nO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB1cmwgPSAnL2Ntcy9hZGRfYmFubmVyLyc7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyhiYW5uZXJJZCk7XHJcbiAgICBzYXZlQnRuLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBpbWFnZV91cmwgPSBpbWFnZVRhZy5hdHRyKCdzcmMnKTtcclxuICAgICAgICB2YXIgcHJpb3JpdHkgPSBwcmlvcml0eVRhZy52YWwoKTtcclxuICAgICAgICB2YXIgbGlua190byA9IGxpbmt0b1RhZy52YWwoKTtcclxuICAgICAgICB4ZnphamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICAndXJsJzogdXJsLFxyXG4gICAgICAgICAgICAnZGF0YSc6IHtcclxuICAgICAgICAgICAgICAgICdpbWFnZV91cmwnOiBpbWFnZV91cmwsXHJcbiAgICAgICAgICAgICAgICAncHJpb3JpdHknOiBwcmlvcml0eSxcclxuICAgICAgICAgICAgICAgICdsaW5rX3RvJzogbGlua190byxcclxuICAgICAgICAgICAgICAgICdwayc6IGJhbm5lcklkLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdFsnY29kZSddID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmFubmVySWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm1lc3NhZ2VCb3guc2hvd1N1Y2Nlc3MoJ+i9ruaSreWbvuS/ruaUueaIkOWKn++8gScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhbm5lcklkID0gcmVzdWx0WydkYXRhJ11bJ2Jhbm5lcl9pZCddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYW5uZXJJdGVtLmF0dHIoJ2RhdGEtYmFubmVyLWlkJywgYmFubmVySWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93U3VjY2Vzcygn6L2u5pKt5Zu+5re75Yqg5a6M5oiQ77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5U3Bhbi50ZXh0KFwi5LyY5YWI57qn77yaXCIgKyBwcmlvcml0eSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuQmFubmVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMubGlzdGVuQWRkQmFubmVyRXZlbnQoKTtcclxuICAgIHRoaXMubG9hZERhdGEoKTtcclxufVxyXG5cclxuJChmdW5jdGlvbigpIHtcclxuICAgIHZhciBiYW5uZXIgPSBuZXcgQmFubmVyKCk7XHJcbiAgICBiYW5uZXIucnVuKCk7XHJcbn0pOyJdfQ==
